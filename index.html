<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Transmission Interceptée</title>

<style>
body {
    margin:0;
    background: radial-gradient(circle at center, #150000 0%, #000 80%);
    color: #f5f5f5;
    font-family: "Consolas", monospace;
    text-align: center;
    overflow:hidden;
}

body::before {
    content: "";
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    pointer-events:none;
    background: repeating-linear-gradient(
        to bottom,
        rgba(255,0,0,0.05),
        rgba(255,0,0,0.05) 2px,
        transparent 2px,
        transparent 4px
    );
    animation: flicker 0.2s infinite;
}

@keyframes flicker {
    0% {opacity:0.95;}
    50% {opacity:1;}
    100% {opacity:0.97;}
}

.screen {
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    height:100vh;
}

button {
    padding: 12px 35px;
    background: black;
    color: gold;
    border: 2px solid darkred;
    font-size: 16px;
    letter-spacing:2px;
    cursor:pointer;
    margin-top:20px;
}

button:hover {
    background:#220000;
}

#loading {
    margin-top:30px;
    color: gold;
    font-size:14px;
    display:none;
}

#mainContent {
    display:none;
    padding:40px;
    max-width:900px;
    margin:auto;
}

h1 {
    color: gold;
    letter-spacing:4px;
}

.message {
    margin-top:30px;
    line-height:1.8;
    min-height:200px;
}

.symbols {
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:15px;
    margin-top:40px;
}

.symbols img {
    width:100%;
    cursor:pointer;
    border:1px solid #330000;
    background:black;
    padding:10px;
    transition:0.15s;
}

.symbols img:hover {
    transform:scale(1.05);
    border:1px solid gold;
}

.slots {
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:30px;
}

.slot {
    width:60px;
    height:60px;
    border:1px solid darkred;
    background:black;
    display:flex;
    align-items:center;
    justify-content:center;
}

#result {
    margin-top:25px;
    color:gold;
    min-height:20px;
}
</style>
</head>

<body>

<div class="screen" id="startScreen">
    <button onclick="startSequence()">DÉMARRER TRANSMISSION</button>
    <div id="loading">Connexion sécurisée...</div>
</div>

<div id="mainContent">
    <h1>TRANSMISSION INTERCEPTÉE</h1>
    <div class="message" id="typedText"></div>

    <div class="symbols" id="symbolGrid" style="opacity:0.4; pointer-events:none;">
        <img src="Image1.png" onclick="ajouter('A','Image1.png')">
        <img src="Image2.png" onclick="ajouter('R','Image2.png')">
        <img src="Image3.png" onclick="ajouter('K','Image3.png')">
        <img src="Image4.png" onclick="ajouter('U','Image4.png')">
        <img src="Image5.png" onclick="ajouter('S','Image5.png')">
    </div>

    <div class="slots">
        <div class="slot"></div>
        <div class="slot"></div>
        <div class="slot"></div>
        <div class="slot"></div>
        <div class="slot"></div>
    </div>

    <button id="resetBtn" onclick="reset()">RÉINITIALISER</button>

    <div id="result"></div>
</div>

<audio id="bgMusic" src="ambience.mp3" loop></audio>

<script>
let selection = [];
let locked = false;
let musicStarted = false;
let typingFinished = false;

const bgMusic = document.getElementById("bgMusic");
const soundClick = new Audio("click.mp3");
const soundFalse = new Audio("error.mp3");
const soundTrue = new Audio("success.mp3");
const soundType = new Audio("type.mp3");
const soundEnd = new Audio("type_end.mp3");

bgMusic.volume = 0.2;

const message = `Ce message n’a pas d’auteur.

Il a une origine.

Nous ne nommons pas les individus.
Nous identifions les points de convergence.

Cherchez ce qui n’est ni un titre,
ni une fonction,
mais un centre autour duquel l’ordre s’organise.

Traduisez.
Assemblez.
Entrez ce qui demeure lorsque tout le reste disparaît.`;

function startSequence() {
    document.getElementById("loading").style.display = "block";

    if (!musicStarted) {
        bgMusic.play().catch(()=>{});
        musicStarted = true;
    }

    setTimeout(() => {
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
        typeWriter();
    }, 2000);
}

function typeWriter() {
    let i = 0;
    const speed = 20;
    const target = document.getElementById("typedText");

    function typing() {
        if (i < message.length) {
            if(message.charAt(i) !== "\n"){
                soundType.currentTime = 0;
                soundType.volume = 0.2;
                soundType.play().catch(()=>{});
            }
            target.innerHTML += message.charAt(i) === "\n" ? "<br>" : message.charAt(i);
            i++;
            setTimeout(typing, speed);
        } else {
            typingFinished = true;
            soundEnd.play().catch(()=>{});
            document.getElementById("symbolGrid").style.opacity = "1";
            document.getElementById("symbolGrid").style.pointerEvents = "auto";
        }
    }
    typing();
}

function ajouter(valeur, image) {
    if (!typingFinished || locked || selection.length >= 5) return;

    soundClick.currentTime = 0;
    soundClick.play().catch(()=>{});

    selection.push(valeur);

    const slot = document.getElementsByClassName("slot")[selection.length - 1];
    const img = document.createElement("img");
    img.src = image;
    slot.appendChild(img);

    if (selection.length === 5) verifier();
}

function verifier() {
    const code = selection.join("");

    if (code === "ARKUS") {
        locked = true;
        document.getElementById("resetBtn").style.display = "none";
        document.getElementById("result").innerText = "CANAL VALIDÉ";

        fadeMusic(0.05, 500);

        soundTrue.play().catch(()=>{});
        soundTrue.onended = function() {
            window.location.href = "countdown.html";
        };

    } else {
        soundFalse.play().catch(()=>{});
        document.getElementById("result").innerText =
            "Correspondance invalide.";

        setTimeout(reset, 1500);
    }
}

function reset() {
    if (locked) return;

    selection = [];
    document.getElementById("result").innerText = "";

    const slots = document.getElementsByClassName("slot");
    for (let s of slots) s.innerHTML = "";
}

function fadeMusic(target, duration) {
    let step = 0.01;
    let interval = duration / ((bgMusic.volume - target) / step);

    let fade = setInterval(() => {
        if (bgMusic.volume > target) {
            bgMusic.volume = Math.max(bgMusic.volume - step, target);
        } else {
            clearInterval(fade);
        }
    }, interval);
}
</script>

</body>
</html>
